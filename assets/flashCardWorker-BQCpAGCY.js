const Xn="RFC3986",Kn={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},li="RFC1738",ui=Array.isArray,ye=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),Zn=1024,di=(r,e,t,n,s)=>{if(r.length===0)return r;let a=r;if(typeof r=="symbol"?a=Symbol.prototype.toString.call(r):typeof r!="string"&&(a=String(r)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=Zn){const c=a.length>=Zn?a.slice(o,o+Zn):a,l=[];for(let u=0;u<c.length;++u){let d=c.charCodeAt(u);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===li&&(d===40||d===41)){l[l.length]=c.charAt(u);continue}if(d<128){l[l.length]=ye[d];continue}if(d<2048){l[l.length]=ye[192|d>>6]+ye[128|d&63];continue}if(d<55296||d>=57344){l[l.length]=ye[224|d>>12]+ye[128|d>>6&63]+ye[128|d&63];continue}u+=1,d=65536+((d&1023)<<10|c.charCodeAt(u)&1023),l[l.length]=ye[240|d>>18]+ye[128|d>>12&63]+ye[128|d>>6&63]+ye[128|d&63]}i+=l.join("")}return i};function hi(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Kr(r,e){if(ui(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const fi=Object.prototype.hasOwnProperty,Es={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},we=Array.isArray,mi=Array.prototype.push,Ts=function(r,e){mi.apply(r,we(e)?e:[e])},pi=Date.prototype.toISOString,q={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:di,encodeValuesOnly:!1,format:Xn,formatter:Kn[Xn],indices:!1,serializeDate(r){return pi.call(r)},skipNulls:!1,strictNullHandling:!1};function gi(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const Dn={};function Is(r,e,t,n,s,a,i,o,c,l,u,d,f,p,k,w,S,H){let v=r,$=H,C=0,V=!1;for(;($=$.get(Dn))!==void 0&&!V;){const B=$.get(r);if(C+=1,typeof B<"u"){if(B===C)throw new RangeError("Cyclic object value");V=!0}typeof $.get(Dn)>"u"&&(C=0)}if(typeof l=="function"?v=l(e,v):v instanceof Date?v=f==null?void 0:f(v):t==="comma"&&we(v)&&(v=Kr(v,function(B){return B instanceof Date?f==null?void 0:f(B):B})),v===null){if(a)return c&&!w?c(e,q.encoder,S,"key",p):e;v=""}if(gi(v)||hi(v)){if(c){const B=w?e:c(e,q.encoder,S,"key",p);return[(k==null?void 0:k(B))+"="+(k==null?void 0:k(c(v,q.encoder,S,"value",p)))]}return[(k==null?void 0:k(e))+"="+(k==null?void 0:k(String(v)))]}const M=[];if(typeof v>"u")return M;let I;if(t==="comma"&&we(v))w&&c&&(v=Kr(v,c)),I=[{value:v.length>0?v.join(",")||null:void 0}];else if(we(l))I=l;else{const B=Object.keys(v);I=u?B.sort(u):B}const ce=o?String(e).replace(/\./g,"%2E"):String(e),z=n&&we(v)&&v.length===1?ce+"[]":ce;if(s&&we(v)&&v.length===0)return z+"[]";for(let B=0;B<I.length;++B){const D=I[B],Xe=typeof D=="object"&&typeof D.value<"u"?D.value:v[D];if(i&&Xe===null)continue;const jn=d&&o?D.replace(/\./g,"%2E"):D,ci=we(v)?typeof t=="function"?t(z,jn):z:z+(d?"."+jn:"["+jn+"]");H.set(r,C);const Xr=new WeakMap;Xr.set(Dn,H),Ts(M,Is(Xe,ci,t,n,s,a,i,o,t==="comma"&&w&&we(v)?null:c,l,u,d,f,p,k,w,S,Xr))}return M}function _i(r=q){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||q.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Xn;if(typeof r.format<"u"){if(!fi.call(Kn,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=Kn[t];let s=q.filter;(typeof r.filter=="function"||we(r.filter))&&(s=r.filter);let a;if(r.arrayFormat&&r.arrayFormat in Es?a=r.arrayFormat:"indices"in r?a=r.indices?"indices":"repeat":a=q.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:q.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:q.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:q.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:q.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?q.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:q.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:q.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:q.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:q.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:q.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:q.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:q.strictNullHandling}}function yi(r,e={}){let t=r;const n=_i(e);let s,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):we(n.filter)&&(a=n.filter,s=a);const i=[];if(typeof t!="object"||t===null)return"";const o=Es[n.arrayFormat],c=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);const l=new WeakMap;for(let f=0;f<s.length;++f){const p=s[f];n.skipNulls&&t[p]===null||Ts(i,Is(t[p],p,o,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}const u=i.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const et="4.98.0";let Gr=!1,At,Os,$s,Gn,Ns,Ms,js,Zs,Ds;function wi(r,e={auto:!1}){if(Gr)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(At)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${At}'\``);Gr=e.auto,At=r.kind,Os=r.fetch,$s=r.FormData,Gn=r.File,Ns=r.ReadableStream,Ms=r.getMultipartRequestOptions,js=r.getDefaultAgent,Zs=r.fileFromPath,Ds=r.isFsReadStream}class vi{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function bi({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,a;try{t=fetch,n=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new vi(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}const Fs=()=>{At||wi(bi(),{auto:!0})};Fs();class x extends Error{}class Q extends x{constructor(e,t,n,s){super(`${Q.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new kn({message:n,cause:Yn(t)});const a=t==null?void 0:t.error;return e===400?new Ls(e,a,n,s):e===401?new Bs(e,a,n,s):e===403?new Us(e,a,n,s):e===404?new Vs(e,a,n,s):e===409?new zs(e,a,n,s):e===422?new Ws(e,a,n,s):e===429?new qs(e,a,n,s):e>=500?new Js(e,a,n,s):new Q(e,a,n,s)}}class le extends Q{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class kn extends Q{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class fr extends kn{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ls extends Q{}class Bs extends Q{}class Us extends Q{}class Vs extends Q{}class zs extends Q{}class Ws extends Q{}class qs extends Q{}class Js extends Q{}class Hs extends x{constructor(){super("Could not parse response content as the length limit was reached")}}class Xs extends x{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var Xt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Le=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ae;class Sn{constructor(){ae.set(this,void 0),this.buffer=new Uint8Array,Xt(this,ae,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let a;for(;(a=xi(this.buffer,Le(this,ae,"f")))!=null;){if(a.carriage&&Le(this,ae,"f")==null){Xt(this,ae,a.index,"f");continue}if(Le(this,ae,"f")!=null&&(a.index!==Le(this,ae,"f")+1||a.carriage)){s.push(this.decodeText(this.buffer.slice(0,Le(this,ae,"f")-1))),this.buffer=this.buffer.slice(Le(this,ae,"f")),Xt(this,ae,null,"f");continue}const i=Le(this,ae,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));s.push(o),this.buffer=this.buffer.slice(a.index),Xt(this,ae,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new x(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new x(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new x("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}ae=new WeakMap;Sn.NEWLINE_CHARS=new Set([`
`,"\r"]);Sn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function xi(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function ki(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function Ks(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class be{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of Si(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(o&&o.error)throw new Q(void 0,o.error,void 0,ra(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(i.event=="error")throw new Q(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new be(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const i=new Sn,o=Ks(e);for await(const c of o)for(const l of i.decode(c))yield l;for(const c of i.flush())yield c}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new be(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new be(()=>s(e),this.controller),new be(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Ns({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await t.next();if(i)return s.close();const o=n.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*Si(r,e){if(!r.body)throw e.abort(),new x("Attempted to iterate over a response with no body");const t=new Pi,n=new Sn,s=Ks(r.body);for await(const a of Ai(s))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Ai(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let a;for(;(a=ki(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class Pi{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=Ci(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function Ci(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const Gs=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",Qs=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&An(r),An=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Ri=r=>Qs(r)||Gs(r)||Ds(r);async function Ys(r,e,t){var s;if(r=await r,Qs(r))return r;if(Gs(r)){const a=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=An(a)?[await a.arrayBuffer()]:[a];return new Gn(i,e,t)}const n=await Ei(r);if(e||(e=Ii(r)??"unknown_file"),!(t!=null&&t.type)){const a=(s=n[0])==null?void 0:s.type;typeof a=="string"&&(t={...t,type:a})}return new Gn(n,e,t)}async function Ei(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(An(r))e.push(await r.arrayBuffer());else if(Oi(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${Ti(r)}`);return e}function Ti(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function Ii(r){var e;return Fn(r.name)||Fn(r.filename)||((e=Fn(r.path))==null?void 0:e.split(/[\\/]/).pop())}const Fn=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},Oi=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Qr=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",lt=async r=>{const e=await $i(r.body);return Ms(e,r)},$i=async r=>{const e=new $s;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Qn(e,t,n))),e},Qn=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(Ri(t)){const n=await Ys(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Qn(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Qn(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var at={},Ni=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},Mi=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Kt;Fs();async function ea(r){var i;const{response:e}=r;if(r.options.stream)return $e("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):be.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(i=t==null?void 0:t.split(";")[0])==null?void 0:i.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const o=await e.json();return $e("response",e.status,e.url,e.headers,o),ta(o,e)}const a=await e.text();return $e("response",e.status,e.url,e.headers,a),a}function ta(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Pn extends Promise{constructor(e,t=ea){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Pn(this.responsePromise,async t=>ta(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ji{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=Ln("maxRetries",t),this.timeout=Ln("timeout",n),this.httpAgent=s,this.fetch=a??Os}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Bi(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Wi()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const a=s&&An(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var w;const n={...e},{method:s,path:a,query:i,headers:o={}}=n,c=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Qr(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,l=this.calculateContentLength(c),u=this.buildURL(a,i);"timeout"in n&&Ln("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const d=n.httpAgent??this.httpAgent??js(u),f=n.timeout+1e3;typeof((w=d==null?void 0:d.options)==null?void 0:w.timeout)=="number"&&f>(d.options.timeout??0)&&(d.options.timeout=f),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:n,headers:o,contentLength:l,retryCount:t});return{req:{method:s,...c&&{body:c},headers:p,...d&&{agent:d},signal:n.signal??null},url:u,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const a={};n&&(a["content-length"]=n);const i=this.defaultHeaders(e);return ns(a,i),ns(a,t),Qr(e.body)&&At!=="node"&&delete a["content-type"],Gt(i,"x-stainless-retry-count")===void 0&&Gt(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),Gt(i,"x-stainless-timeout")===void 0&&Gt(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return Q.generate(e,t,n,s)}request(e,t=null){return new Pn(this.makeRequest(e,t))}async makeRequest(e,t){var d,f;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:a,url:i,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:n}),$e("request",i,n,a.headers),(d=n.signal)!=null&&d.aborted)throw new le;const c=new AbortController,l=await this.fetchWithTimeout(i,a,o,c).catch(Yn);if(l instanceof Error){if((f=n.signal)!=null&&f.aborted)throw new le;if(t)return this.retryRequest(n,t);throw l.name==="AbortError"?new fr:new kn({cause:l})}const u=ra(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const v=`retrying, ${t} attempts remaining`;return $e(`response (error; ${v})`,l.status,i,u),this.retryRequest(n,t,u)}const p=await l.text().catch(v=>Yn(v).message),k=Ui(p),w=k?void 0:p;throw $e(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,u,w),this.makeStatusError(l.status,k,w,u)}return{response:l,options:n,controller:c}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Zi(this,n,e)}buildURL(e,t){const n=zi(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return sa(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new x(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),c={signal:s.signal,...i};return c.method&&(c.method=c.method.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const a=n==null?void 0:n["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=n==null?void 0:n["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Ut(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${et}`}}class na{constructor(e,t,n,s){Kt.set(this,void 0),Ni(this,Kt,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new x("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,a]of n)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await Mi(this,Kt,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Kt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Zi extends Pn{constructor(e,t,n){super(t,async s=>new n(e,s.response,await ea(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const ra=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Di={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},U=r=>typeof r=="object"&&r!==null&&!sa(r)&&Object.keys(r).every(e=>aa(Di,e)),Fi=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":et,"X-Stainless-OS":es(Deno.build.os),"X-Stainless-Arch":Yr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":et,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":et,"X-Stainless-OS":es(process.platform),"X-Stainless-Arch":Yr(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=Li();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":et,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":et,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Li(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const Yr=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",es=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let ts;const Bi=()=>ts??(ts=Fi()),Ui=r=>{try{return JSON.parse(r)}catch{return}},Vi=/^[a-z][a-z0-9+.-]*:/i,zi=r=>Vi.test(r),Ut=r=>new Promise(e=>setTimeout(e,r)),Ln=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new x(`${r} must be an integer`);if(e<0)throw new x(`${r} must be a positive integer`);return e},Yn=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},Ve=r=>{var e,t,n,s;if(typeof process<"u")return((e=at==null?void 0:at[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function sa(r){if(!r)return!0;for(const e in r)return!1;return!0}function aa(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function ns(r,e){for(const t in e){if(!aa(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}const rs=new Set(["authorization","api-key"]);function $e(r,...e){if(typeof process<"u"&&(at==null?void 0:at.DEBUG)==="true"){const t=e.map(n=>{if(!n)return n;if(n.headers){const a={...n,headers:{...n.headers}};for(const i in n.headers)rs.has(i.toLowerCase())&&(a.headers[i]="REDACTED");return a}let s=null;for(const a in n)rs.has(a.toLowerCase())&&(s??(s={...n}),s[a]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}const Wi=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),qi=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Ji=r=>typeof(r==null?void 0:r.get)=="function",Gt=(r,e)=>{var n;const t=e.toLowerCase();if(Ji(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,t,e.toUpperCase(),s]){const i=r.get(a);if(i)return i}}for(const[s,a]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a},Hi=r=>{if(typeof Buffer<"u"){const e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(r),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}};function rn(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}class Cn extends na{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Y extends na{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class P{constructor(e){this._client=e}}let ia=class extends P{list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Xi,{query:t,...n})}},Rn=class extends P{constructor(){super(...arguments),this.messages=new ia(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/chat/completions",En,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class En extends Y{}class Xi extends Y{}Rn.ChatCompletionsPage=En;Rn.Messages=ia;let Tn=class extends P{constructor(){super(...arguments),this.completions=new Rn(this._client)}};Tn.Completions=Rn;Tn.ChatCompletionsPage=En;class oa extends P{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class ca extends P{create(e,t){return this._client.post("/audio/transcriptions",lt({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class la extends P{create(e,t){return this._client.post("/audio/translations",lt({body:e,...t,__metadata:{model:e.model}}))}}class Vt extends P{constructor(){super(...arguments),this.transcriptions=new ca(this._client),this.translations=new la(this._client),this.speech=new oa(this._client)}}Vt.Transcriptions=ca;Vt.Translations=la;Vt.Speech=oa;class mr extends P{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/batches",pr,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class pr extends Y{}mr.BatchesPage=pr;var he=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},F=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},er,sn,an,_t,yt,on,wt,Pe,vt,dn,hn,tt,ua;class gr{constructor(){er.add(this),this.controller=new AbortController,sn.set(this,void 0),an.set(this,()=>{}),_t.set(this,()=>{}),yt.set(this,void 0),on.set(this,()=>{}),wt.set(this,()=>{}),Pe.set(this,{}),vt.set(this,!1),dn.set(this,!1),hn.set(this,!1),tt.set(this,!1),he(this,sn,new Promise((e,t)=>{he(this,an,e,"f"),he(this,_t,t,"f")}),"f"),he(this,yt,new Promise((e,t)=>{he(this,on,e,"f"),he(this,wt,t,"f")}),"f"),F(this,sn,"f").catch(()=>{}),F(this,yt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},F(this,er,"m",ua).bind(this))},0)}_connected(){this.ended||(F(this,an,"f").call(this),this._emit("connect"))}get ended(){return F(this,vt,"f")}get errored(){return F(this,dn,"f")}get aborted(){return F(this,hn,"f")}abort(){this.controller.abort()}on(e,t){return(F(this,Pe,"f")[e]||(F(this,Pe,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=F(this,Pe,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(F(this,Pe,"f")[e]||(F(this,Pe,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{he(this,tt,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){he(this,tt,!0,"f"),await F(this,yt,"f")}_emit(e,...t){if(F(this,vt,"f"))return;e==="end"&&(he(this,vt,!0,"f"),F(this,on,"f").call(this));const n=F(this,Pe,"f")[e];if(n&&(F(this,Pe,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!F(this,tt,"f")&&!(n!=null&&n.length)&&Promise.reject(s),F(this,_t,"f").call(this,s),F(this,wt,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!F(this,tt,"f")&&!(n!=null&&n.length)&&Promise.reject(s),F(this,_t,"f").call(this,s),F(this,wt,"f").call(this,s),this._emit("end")}}_emitFinal(){}}sn=new WeakMap,an=new WeakMap,_t=new WeakMap,yt=new WeakMap,on=new WeakMap,wt=new WeakMap,Pe=new WeakMap,vt=new WeakMap,dn=new WeakMap,hn=new WeakMap,tt=new WeakMap,er=new WeakSet,ua=function(e){if(he(this,dn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new le),e instanceof le)return he(this,hn,!0,"f"),this._emit("abort",e);if(e instanceof x)return this._emit("error",e);if(e instanceof Error){const t=new x(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new x(String(e)))};var b=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},se=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},K,tr,ve,cn,fe,ze,rt,Ue,fn,ie,ln,un,Pt,bt,xt,ss,as,is,os,cs,ls,us;class me extends gr{constructor(){super(...arguments),K.add(this),tr.set(this,[]),ve.set(this,{}),cn.set(this,{}),fe.set(this,void 0),ze.set(this,void 0),rt.set(this,void 0),Ue.set(this,void 0),fn.set(this,void 0),ie.set(this,void 0),ln.set(this,void 0),un.set(this,void 0),Pt.set(this,void 0)}[(tr=new WeakMap,ve=new WeakMap,cn=new WeakMap,fe=new WeakMap,ze=new WeakMap,rt=new WeakMap,Ue=new WeakMap,fn=new WeakMap,ie=new WeakMap,ln=new WeakMap,un=new WeakMap,Pt=new WeakMap,K=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new me;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=be.fromReadableStream(e,this.controller);for await(const i of s)b(this,K,"m",bt).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new le;return this._addRun(b(this,K,"m",xt).call(this))}toReadableStream(){return new be(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,a){const i=new me;return i._run(()=>i._runToolAssistantStream(e,t,n,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,s,a){var l;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},c=await e.submitToolOutputs(t,n,o,{...a,signal:this.controller.signal});this._connected();for await(const u of c)b(this,K,"m",bt).call(this,u);if((l=c.controller.signal)!=null&&l.aborted)throw new le;return this._addRun(b(this,K,"m",xt).call(this))}static createThreadAssistantStream(e,t,n){const s=new me;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const a=new me;return a._run(()=>a._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return b(this,ln,"f")}currentRun(){return b(this,un,"f")}currentMessageSnapshot(){return b(this,fe,"f")}currentRunStepSnapshot(){return b(this,Pt,"f")}async finalRunSteps(){return await this.done(),Object.values(b(this,ve,"f"))}async finalMessages(){return await this.done(),Object.values(b(this,cn,"f"))}async finalRun(){if(await this.done(),!b(this,ze,"f"))throw Error("Final run was not received.");return b(this,ze,"f")}async _createThreadAssistantStream(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const c of i)b(this,K,"m",bt).call(this,c);if((o=i.controller.signal)!=null&&o.aborted)throw new le;return this._addRun(b(this,K,"m",xt).call(this))}async _createAssistantStream(e,t,n,s){var c;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(const l of o)b(this,K,"m",bt).call(this,l);if((c=o.controller.signal)!=null&&c.aborted)throw new le;return this._addRun(b(this,K,"m",xt).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let a=e[n];if(a==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(rn(a)&&rn(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!rn(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const c=a[o];c==null?a.push(i):a[o]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,a){return await this._createToolAssistantStream(n,e,t,s,a)}}bt=function(e){if(!this.ended)switch(se(this,ln,e,"f"),b(this,K,"m",is).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":b(this,K,"m",us).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":b(this,K,"m",as).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":b(this,K,"m",ss).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},xt=function(){if(this.ended)throw new x("stream has ended, this shouldn't happen");if(!b(this,ze,"f"))throw Error("Final run has not been received");return b(this,ze,"f")},ss=function(e){const[t,n]=b(this,K,"m",cs).call(this,e,b(this,fe,"f"));se(this,fe,t,"f"),b(this,cn,"f")[t.id]=t;for(const s of n){const a=t.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=b(this,rt,"f")){if(b(this,Ue,"f"))switch(b(this,Ue,"f").type){case"text":this._emit("textDone",b(this,Ue,"f").text,b(this,fe,"f"));break;case"image_file":this._emit("imageFileDone",b(this,Ue,"f").image_file,b(this,fe,"f"));break}se(this,rt,s.index,"f")}se(this,Ue,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(b(this,rt,"f")!==void 0){const s=e.data.content[b(this,rt,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,b(this,fe,"f"));break;case"text":this._emit("textDone",s.text,b(this,fe,"f"));break}}b(this,fe,"f")&&this._emit("messageDone",e.data),se(this,fe,void 0,"f")}},as=function(e){const t=b(this,K,"m",os).call(this,e);switch(se(this,Pt,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==b(this,fn,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(b(this,ie,"f")&&this._emit("toolCallDone",b(this,ie,"f")),se(this,fn,a.index,"f"),se(this,ie,t.step_details.tool_calls[a.index],"f"),b(this,ie,"f")&&this._emit("toolCallCreated",b(this,ie,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":se(this,Pt,void 0,"f"),e.data.step_details.type=="tool_calls"&&b(this,ie,"f")&&(this._emit("toolCallDone",b(this,ie,"f")),se(this,ie,void 0,"f")),this._emit("runStepDone",e.data,t);break}},is=function(e){b(this,tr,"f").push(e),this._emit("event",e)},os=function(e){switch(e.event){case"thread.run.step.created":return b(this,ve,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=b(this,ve,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=me.accumulateDelta(t,n.delta);b(this,ve,"f")[e.data.id]=s}return b(this,ve,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":b(this,ve,"f")[e.data.id]=e.data;break}if(b(this,ve,"f")[e.data.id])return b(this,ve,"f")[e.data.id];throw new Error("No snapshot available")},cs=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=b(this,K,"m",ls).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ls=function(e,t){return me.accumulateDelta(t,e)},us=function(e){switch(se(this,un,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":se(this,ze,e.data,"f"),b(this,ie,"f")&&(this._emit("toolCallDone",b(this,ie,"f")),se(this,ie,void 0,"f"));break}};class _r extends P{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/assistants",yr,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class yr extends Y{}_r.AssistantsPage=yr;function ds(r){return typeof r.parse=="function"}const it=r=>(r==null?void 0:r.role)==="assistant",da=r=>(r==null?void 0:r.role)==="function",ha=r=>(r==null?void 0:r.role)==="tool";function Ki(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function wr(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function zt(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function Gi(r,e){return!e||!fa(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:vr(r,e)}function vr(r,e){const t=r.choices.map(n=>{var s;if(n.finish_reason==="length")throw new Hs;if(n.finish_reason==="content_filter")throw new Xs;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(a=>Yi(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Qi(e,n.message.content):null}}});return{...r,choices:t}}function Qi(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function Yi(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:zt(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function eo(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return zt(t)||(t==null?void 0:t.function.strict)||!1}function fa(r){var e;return wr(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>zt(t)||t.type==="function"&&t.function.strict===!0))??!1}function to(r){for(const e of r??[]){if(e.type!=="function")throw new x(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new x(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var re=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ee,nr,mn,rr,sr,ar,ma,ir;const hs=10;class pa extends gr{constructor(){super(...arguments),ee.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(da(e)||ha(e))&&e.content)this._emit("functionCallResult",e.content);else if(it(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(it(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new x("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),re(this,ee,"m",nr).call(this)}async finalMessage(){return await this.done(),re(this,ee,"m",mn).call(this)}async finalFunctionCall(){return await this.done(),re(this,ee,"m",rr).call(this)}async finalFunctionCallResult(){return await this.done(),re(this,ee,"m",sr).call(this)}async totalUsage(){return await this.done(),re(this,ee,"m",ar).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=re(this,ee,"m",mn).call(this);t&&this._emit("finalMessage",t);const n=re(this,ee,"m",nr).call(this);n&&this._emit("finalContent",n);const s=re(this,ee,"m",rr).call(this);s&&this._emit("finalFunctionCall",s);const a=re(this,ee,"m",sr).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",re(this,ee,"m",ar).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),re(this,ee,"m",ma).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(vr(a,t))}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var f;const s="function",{function_call:a="auto",stream:i,...o}=t,c=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:l=hs}=n||{},u={};for(const p of t.functions)u[p.name||p.function.name]=p;const d=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){const w=(f=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:f.message;if(!w)throw new x("missing message in ChatCompletion response");if(!w.function_call)return;const{name:S,arguments:H}=w.function_call,v=u[S];if(v){if(c&&c!==S){const M=`Invalid function_call: ${JSON.stringify(S)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,name:S,content:M});continue}}else{const M=`Invalid function_call: ${JSON.stringify(S)}. Available options are: ${d.map(I=>JSON.stringify(I.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:S,content:M});continue}let $;try{$=ds(v)?await v.parse(H):H}catch(M){this._addMessage({role:s,name:S,content:M instanceof Error?M.message:String(M)});continue}const C=await v.function($,this),V=re(this,ee,"m",ir).call(this,C);if(this._addMessage({role:s,name:S,content:V}),c)return}}async _runTools(e,t,n){var p,k,w;const s="tool",{tool_choice:a="auto",stream:i,...o}=t,c=typeof a!="string"&&((p=a==null?void 0:a.function)==null?void 0:p.name),{maxChatCompletions:l=hs}=n||{},u=t.tools.map(S=>{if(zt(S)){if(!S.$callback)throw new x("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:S.$callback,name:S.function.name,description:S.function.description||"",parameters:S.function.parameters,parse:S.$parseRaw,strict:!0}}}return S}),d={};for(const S of u)S.type==="function"&&(d[S.function.name||S.function.function.name]=S.function);const f="tools"in t?u.map(S=>S.type==="function"?{type:"function",function:{name:S.function.name||S.function.function.name,parameters:S.function.parameters,description:S.function.description,strict:S.function.strict}}:S):void 0;for(const S of t.messages)this._addMessage(S,!1);for(let S=0;S<l;++S){const v=(k=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:f,messages:[...this.messages]},n)).choices[0])==null?void 0:k.message;if(!v)throw new x("missing message in ChatCompletion response");if(!((w=v.tool_calls)!=null&&w.length))return;for(const $ of v.tool_calls){if($.type!=="function")continue;const C=$.id,{name:V,arguments:M}=$.function,I=d[V];if(I){if(c&&c!==V){const D=`Invalid tool_call: ${JSON.stringify(V)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:C,content:D});continue}}else{const D=`Invalid tool_call: ${JSON.stringify(V)}. Available options are: ${Object.keys(d).map(Xe=>JSON.stringify(Xe)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:C,content:D});continue}let ce;try{ce=ds(I)?await I.parse(M):M}catch(D){const Xe=D instanceof Error?D.message:String(D);this._addMessage({role:s,tool_call_id:C,content:Xe});continue}const z=await I.function(ce,this),B=re(this,ee,"m",ir).call(this,z);if(this._addMessage({role:s,tool_call_id:C,content:B}),c)return}}}}ee=new WeakSet,nr=function(){return re(this,ee,"m",mn).call(this).content??null},mn=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(it(t)){const{function_call:n,...s}=t,a={...s,content:t.content??null,refusal:t.refusal??null};return n&&(a.function_call=n),a}}throw new x("stream ended without producing a ChatCompletionMessage with role=assistant")},rr=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(it(s)&&(s!=null&&s.function_call))return s.function_call;if(it(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},sr=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(da(t)&&t.content!=null||ha(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},ar=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ma=function(e){if(e.n!=null&&e.n>1)throw new x("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ir=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Ct extends pa{static runFunctions(e,t,n){const s=new Ct,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new Ct,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e,t=!0){super._addMessage(e,t),it(e)&&e.content&&this._emit("content",e.content)}}const ga=1,_a=2,ya=4,wa=8,va=16,ba=32,xa=64,ka=128,Sa=256,Aa=ka|Sa,Pa=va|ba|Aa|xa,Ca=ga|_a|Pa,Ra=ya|wa,no=Ca|Ra,J={STR:ga,NUM:_a,ARR:ya,OBJ:wa,NULL:va,BOOL:ba,NAN:xa,INFINITY:ka,MINUS_INFINITY:Sa,INF:Aa,SPECIAL:Pa,ATOM:Ca,COLLECTION:Ra,ALL:no};class ro extends Error{}class so extends Error{}function ao(r,e=J.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return io(r.trim(),e)}const io=(r,e)=>{const t=r.length;let n=0;const s=f=>{throw new ro(`${f} at position ${n}`)},a=f=>{throw new so(`${f} at position ${n}`)},i=()=>(d(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?c():r[n]==="["?l():r.substring(n,n+4)==="null"||J.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||J.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||J.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||J.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||J.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||J.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):u()),o=()=>{const f=n;let p=!1;for(n++;n<t&&(r[n]!=='"'||p&&r[n-1]==="\\");)p=r[n]==="\\"?!p:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(f,++n-Number(p)))}catch(k){a(String(k))}else if(J.STR&e)try{return JSON.parse(r.substring(f,n-Number(p))+'"')}catch{return JSON.parse(r.substring(f,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{n++,d();const f={};try{for(;r[n]!=="}";){if(d(),n>=t&&J.OBJ&e)return f;const p=o();d(),n++;try{const k=i();Object.defineProperty(f,p,{value:k,writable:!0,enumerable:!0,configurable:!0})}catch(k){if(J.OBJ&e)return f;throw k}d(),r[n]===","&&n++}}catch{if(J.OBJ&e)return f;s("Expected '}' at end of object")}return n++,f},l=()=>{n++;const f=[];try{for(;r[n]!=="]";)f.push(i()),d(),r[n]===","&&n++}catch{if(J.ARR&e)return f;s("Expected ']' at end of array")}return n++,f},u=()=>{if(n===0){r==="-"&&J.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(p){if(J.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}a(String(p))}}const f=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(J.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(f,n))}catch{r.substring(f,n)==="-"&&J.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(f,r.lastIndexOf("e")))}catch(k){a(String(k))}}},d=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return i()},fs=r=>ao(r,J.ALL^J.NUM);var Ke=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Z=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},W,Ae,Ge,Te,Bn,Qt,Un,Vn,zn,Yt,Wn,ms;class Rt extends pa{constructor(e){super(),W.add(this),Ae.set(this,void 0),Ge.set(this,void 0),Te.set(this,void 0),Ke(this,Ae,e,"f"),Ke(this,Ge,[],"f")}get currentChatCompletionSnapshot(){return Z(this,Te,"f")}static fromReadableStream(e){const t=new Rt(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new Rt(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Z(this,W,"m",Bn).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)Z(this,W,"m",Un).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new le;return this._addChatCompletion(Z(this,W,"m",Yt).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Z(this,W,"m",Bn).call(this),this._connected();const s=be.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(Z(this,W,"m",Yt).call(this)),Z(this,W,"m",Un).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new le;return this._addChatCompletion(Z(this,W,"m",Yt).call(this))}[(Ae=new WeakMap,Ge=new WeakMap,Te=new WeakMap,W=new WeakSet,Bn=function(){this.ended||Ke(this,Te,void 0,"f")},Qt=function(t){let n=Z(this,Ge,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Z(this,Ge,"f")[t.index]=n,n)},Un=function(t){var s,a,i,o,c,l,u,d,f,p,k,w,S,H,v;if(this.ended)return;const n=Z(this,W,"m",ms).call(this,t);this._emit("chunk",t,n);for(const $ of t.choices){const C=n.choices[$.index];$.delta.content!=null&&((s=C.message)==null?void 0:s.role)==="assistant"&&((a=C.message)!=null&&a.content)&&(this._emit("content",$.delta.content,C.message.content),this._emit("content.delta",{delta:$.delta.content,snapshot:C.message.content,parsed:C.message.parsed})),$.delta.refusal!=null&&((i=C.message)==null?void 0:i.role)==="assistant"&&((o=C.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:$.delta.refusal,snapshot:C.message.refusal}),((c=$.logprobs)==null?void 0:c.content)!=null&&((l=C.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=$.logprobs)==null?void 0:u.content,snapshot:((d=C.logprobs)==null?void 0:d.content)??[]}),((f=$.logprobs)==null?void 0:f.refusal)!=null&&((p=C.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(k=$.logprobs)==null?void 0:k.refusal,snapshot:((w=C.logprobs)==null?void 0:w.refusal)??[]});const V=Z(this,W,"m",Qt).call(this,C);C.finish_reason&&(Z(this,W,"m",zn).call(this,C),V.current_tool_call_index!=null&&Z(this,W,"m",Vn).call(this,C,V.current_tool_call_index));for(const M of $.delta.tool_calls??[])V.current_tool_call_index!==M.index&&(Z(this,W,"m",zn).call(this,C),V.current_tool_call_index!=null&&Z(this,W,"m",Vn).call(this,C,V.current_tool_call_index)),V.current_tool_call_index=M.index;for(const M of $.delta.tool_calls??[]){const I=(S=C.message.tool_calls)==null?void 0:S[M.index];I!=null&&I.type&&((I==null?void 0:I.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(H=I.function)==null?void 0:H.name,index:M.index,arguments:I.function.arguments,parsed_arguments:I.function.parsed_arguments,arguments_delta:((v=M.function)==null?void 0:v.arguments)??""}):(I==null||I.type,void 0))}}},Vn=function(t,n){var i,o,c;if(Z(this,W,"m",Qt).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const l=(c=(o=Z(this,Ae,"f"))==null?void 0:o.tools)==null?void 0:c.find(u=>u.type==="function"&&u.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:zt(l)?l.$parseRaw(a.function.arguments):l!=null&&l.function.strict?JSON.parse(a.function.arguments):null})}else a.type},zn=function(t){var s,a;const n=Z(this,W,"m",Qt).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=Z(this,W,"m",Wn).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Yt=function(){if(this.ended)throw new x("stream has ended, this shouldn't happen");const t=Z(this,Te,"f");if(!t)throw new x("request ended without sending any chunks");return Ke(this,Te,void 0,"f"),Ke(this,Ge,[],"f"),oo(t,Z(this,Ae,"f"))},Wn=function(){var n;const t=(n=Z(this,Ae,"f"))==null?void 0:n.response_format;return wr(t)?t:null},ms=function(t){var n,s,a,i;let o=Z(this,Te,"f");const{choices:c,...l}=t;o?Object.assign(o,l):o=Ke(this,Te,{...l,choices:[]},"f");for(const{delta:u,finish_reason:d,index:f,logprobs:p=null,...k}of t.choices){let w=o.choices[f];if(w||(w=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:p,...k}),p)if(!w.logprobs)w.logprobs=Object.assign({},p);else{const{content:M,refusal:I,...ce}=p;Object.assign(w.logprobs,ce),M&&((n=w.logprobs).content??(n.content=[]),w.logprobs.content.push(...M)),I&&((s=w.logprobs).refusal??(s.refusal=[]),w.logprobs.refusal.push(...I))}if(d&&(w.finish_reason=d,Z(this,Ae,"f")&&fa(Z(this,Ae,"f")))){if(d==="length")throw new Hs;if(d==="content_filter")throw new Xs}if(Object.assign(w,k),!u)continue;const{content:S,refusal:H,function_call:v,role:$,tool_calls:C,...V}=u;if(Object.assign(w.message,V),H&&(w.message.refusal=(w.message.refusal||"")+H),$&&(w.message.role=$),v&&(w.message.function_call?(v.name&&(w.message.function_call.name=v.name),v.arguments&&((a=w.message.function_call).arguments??(a.arguments=""),w.message.function_call.arguments+=v.arguments)):w.message.function_call=v),S&&(w.message.content=(w.message.content||"")+S,!w.message.refusal&&Z(this,W,"m",Wn).call(this)&&(w.message.parsed=fs(w.message.content))),C){w.message.tool_calls||(w.message.tool_calls=[]);for(const{index:M,id:I,type:ce,function:z,...B}of C){const D=(i=w.message.tool_calls)[M]??(i[M]={});Object.assign(D,B),I&&(D.id=I),ce&&(D.type=ce),z&&(D.function??(D.function={name:z.name??"",arguments:""})),z!=null&&z.name&&(D.function.name=z.name),z!=null&&z.arguments&&(D.function.arguments+=z.arguments,eo(Z(this,Ae,"f"),D)&&(D.function.parsed_arguments=fs(D.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new be(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function oo(r,e){const{id:t,choices:n,created:s,model:a,system_fingerprint:i,...o}=r,c={...o,id:t,choices:n.map(({message:l,finish_reason:u,index:d,logprobs:f,...p})=>{if(!u)throw new x(`missing finish_reason for choice ${d}`);const{content:k=null,function_call:w,tool_calls:S,...H}=l,v=l.role;if(!v)throw new x(`missing role for choice ${d}`);if(w){const{arguments:$,name:C}=w;if($==null)throw new x(`missing function_call.arguments for choice ${d}`);if(!C)throw new x(`missing function_call.name for choice ${d}`);return{...p,message:{content:k,function_call:{arguments:$,name:C},role:v,refusal:l.refusal??null},finish_reason:u,index:d,logprobs:f}}return S?{...p,index:d,finish_reason:u,logprobs:f,message:{...H,role:v,content:k,refusal:l.refusal??null,tool_calls:S.map(($,C)=>{const{function:V,type:M,id:I,...ce}=$,{arguments:z,name:B,...D}=V||{};if(I==null)throw new x(`missing choices[${d}].tool_calls[${C}].id
${en(r)}`);if(M==null)throw new x(`missing choices[${d}].tool_calls[${C}].type
${en(r)}`);if(B==null)throw new x(`missing choices[${d}].tool_calls[${C}].function.name
${en(r)}`);if(z==null)throw new x(`missing choices[${d}].tool_calls[${C}].function.arguments
${en(r)}`);return{...ce,id:I,type:M,function:{...D,name:B,arguments:z}}})}}:{...p,message:{...H,content:k,role:v,refusal:l.refusal??null},finish_reason:u,index:d,logprobs:f}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Gi(c,e)}function en(r){return JSON.stringify(r)}class ot extends Rt{static fromReadableStream(e){const t=new ot(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new ot(null),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new ot(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}}let Ea=class extends P{parse(e,t){return to(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>vr(n,e))}runFunctions(e,t){return e.stream?ot.runFunctions(this._client,e,t):Ct.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ot.runTools(this._client,e,t):Ct.runTools(this._client,e,t)}stream(e,t){return Rt.createChatCompletion(this._client,e,t)}};class or extends P{constructor(){super(...arguments),this.completions=new Ea(this._client)}}(function(r){r.Completions=Ea})(or||(or={}));class Ta extends P{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ia extends P{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class In extends P{constructor(){super(...arguments),this.sessions=new Ta(this._client),this.transcriptionSessions=new Ia(this._client)}}In.Sessions=Ta;In.TranscriptionSessions=Ia;class br extends P{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,xr,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class xr extends Y{}br.MessagesPage=xr;class kr extends P{retrieve(e,t,n,s={},a){return U(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,n={},s){return U(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Sr,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Sr extends Y{}kr.RunStepsPage=Sr;let Wt=class extends P{constructor(){super(...arguments),this.steps=new kr(this._client)}create(e,t,n){const{include:s,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Ar,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return me.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await Ut(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return me.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const a=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,n,s){return me.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}};class Ar extends Y{}Wt.RunsPage=Ar;Wt.Steps=kr;Wt.RunStepsPage=Sr;class ft extends P{constructor(){super(...arguments),this.runs=new Wt(this._client),this.messages=new br(this._client)}create(e={},t){return U(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return me.createThreadAssistantStream(e,this._client.beta.threads,t)}}ft.Runs=Wt;ft.RunsPage=Ar;ft.Messages=br;ft.MessagesPage=xr;class mt extends P{constructor(){super(...arguments),this.realtime=new In(this._client),this.chat=new or(this._client),this.assistants=new _r(this._client),this.threads=new ft(this._client)}}mt.Realtime=In;mt.Assistants=_r;mt.AssistantsPage=yr;mt.Threads=ft;class Oa extends P{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class $a extends P{create(e,t){const n=!!e.encoding_format;let s=n?e.encoding_format:"base64";n&&$e("Request","User defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return n?a:($e("response","Decoding base64 embeddings to float32 array"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{const c=o.embedding;o.embedding=Hi(c)}),i)))}}class Pr extends P{retrieve(e,t,n,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,s)}list(e,t,n={},s){return U(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,Cr,{query:n,...s})}}class Cr extends Y{}Pr.OutputItemListResponsesPage=Cr;class qt extends P{constructor(){super(...arguments),this.outputItems=new Pr(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Rr,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class Rr extends Y{}qt.RunListResponsesPage=Rr;qt.OutputItems=Pr;qt.OutputItemListResponsesPage=Cr;class Jt extends P{constructor(){super(...arguments),this.runs=new qt(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/evals",Er,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class Er extends Y{}Jt.EvalListResponsesPage=Er;Jt.Runs=qt;Jt.RunListResponsesPage=Rr;let Tr=class extends P{create(e,t){return this._client.post("/files",lt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/files",Ir,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await Ut(t),i=await this.retrieve(e),Date.now()-a>n)throw new fr({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class Ir extends Y{}Tr.FileObjectsPage=Ir;class Na extends P{}let Ma=class extends P{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class Or extends P{constructor(){super(...arguments),this.graders=new Ma(this._client)}}Or.Graders=Ma;class $r extends P{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Nr,{body:t,method:"post",...n})}retrieve(e,t={},n){return U(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}}class Nr extends Cn{}$r.PermissionCreateResponsesPage=Nr;let On=class extends P{constructor(){super(...arguments),this.permissions=new $r(this._client)}};On.Permissions=$r;On.PermissionCreateResponsesPage=Nr;class Mr extends P{list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,jr,{query:t,...n})}}class jr extends Y{}Mr.FineTuningJobCheckpointsPage=jr;class pt extends P{constructor(){super(...arguments),this.checkpoints=new Mr(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Zr,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return U(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Dr,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class Zr extends Y{}class Dr extends Y{}pt.FineTuningJobsPage=Zr;pt.FineTuningJobEventsPage=Dr;pt.Checkpoints=Mr;pt.FineTuningJobCheckpointsPage=jr;class De extends P{constructor(){super(...arguments),this.methods=new Na(this._client),this.jobs=new pt(this._client),this.checkpoints=new On(this._client),this.alpha=new Or(this._client)}}De.Methods=Na;De.Jobs=pt;De.FineTuningJobsPage=Zr;De.FineTuningJobEventsPage=Dr;De.Checkpoints=On;De.Alpha=Or;class ja extends P{}class Fr extends P{constructor(){super(...arguments),this.graderModels=new ja(this._client)}}Fr.GraderModels=ja;class Za extends P{createVariation(e,t){return this._client.post("/images/variations",lt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",lt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Lr extends P{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Br,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Br extends Cn{}Lr.ModelsPage=Br;class Da extends P{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function co(r,e){return!e||!uo(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Fa(r,e)}function Fa(r,e){const t=r.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:mo(e,s)};if(s.type==="message"){const a=s.content.map(i=>i.type==="output_text"?{...i,parsed:lo(e,i.text)}:i);return{...s,content:a}}return s}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||La(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const s of n.output)if(s.type==="message"){for(const a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function lo(r,e){var t,n,s,a;return((n=(t=r.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((s=r.text)==null?void 0:s.format)?((a=r.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function uo(r){var e;return!!wr((e=r.text)==null?void 0:e.format)}function ho(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function fo(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function mo(r,e){const t=fo(r.tools??[],e.name);return{...e,...e,parsed_arguments:ho(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function La(r){const e=[];for(const t of r.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}class Ba extends P{list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,go,{query:t,...n})}}var Qe=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ie=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ye,tn,Oe,nn,ps,gs,_s,ys;class Ur extends gr{constructor(e){super(),Ye.add(this),tn.set(this,void 0),Oe.set(this,void 0),nn.set(this,void 0),Qe(this,tn,e,"f")}static createResponse(e,t,n){const s=new Ur(t);return s._run(()=>s._createResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createResponse(e,t,n){var i;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ie(this,Ye,"m",ps).call(this);const a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)Ie(this,Ye,"m",gs).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new le;return Ie(this,Ye,"m",_s).call(this)}[(tn=new WeakMap,Oe=new WeakMap,nn=new WeakMap,Ye=new WeakSet,ps=function(){this.ended||Qe(this,Oe,void 0,"f")},gs=function(t){if(this.ended)return;const n=Ie(this,Ye,"m",ys).call(this,t);switch(this._emit("event",t),t.type){case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new x(`missing output at index ${t.output_index}`);if(s.type==="message"){const a=s.content[t.content_index];if(!a)throw new x(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new x(`expected content to be 'output_text', got ${a.type}`);this._emit("response.output_text.delta",{...t,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new x(`missing output at index ${t.output_index}`);s.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...t,snapshot:s.arguments});break}default:this._emit(t.type,t);break}},_s=function(){if(this.ended)throw new x("stream has ended, this shouldn't happen");const t=Ie(this,Oe,"f");if(!t)throw new x("request ended without sending any events");Qe(this,Oe,void 0,"f");const n=po(t,Ie(this,tn,"f"));return Qe(this,nn,n,"f"),n},ys=function(t){let n=Ie(this,Oe,"f");if(!n){if(t.type!=="response.created")throw new x(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Qe(this,Oe,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const s=n.output[t.output_index];if(!s)throw new x(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new x(`missing output at index ${t.output_index}`);if(s.type==="message"){const a=s.content[t.content_index];if(!a)throw new x(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new x(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new x(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Qe(this,Oe,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Ie(this,nn,"f");if(!e)throw new x("stream ended without producing a ChatCompletion");return e}}function po(r,e){return co(r,e)}class Vr extends P{constructor(){super(...arguments),this.inputItems=new Ba(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&La(n),n))}retrieve(e,t={},n){return U(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...n})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Fa(n,e))}stream(e,t){return Ur.createResponse(this._client,e,t)}}class go extends Y{}Vr.InputItems=Ba;class Ua extends P{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,lt({body:t,...n}))}}class zr extends P{constructor(){super(...arguments),this.parts=new Ua(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}zr.Parts=Ua;const _o=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};class $n extends P{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return U(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Nn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const c=a.response.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await Ut(o);break;case"failed":case"completed":return i}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Wr,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Nn extends Y{}class Wr extends Cn{}$n.VectorStoreFilesPage=Nn;$n.FileContentResponsesPage=Wr;class Va extends P{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return U(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Nn,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await Ut(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,c=t.values(),l=[...n];async function u(f){for(let p of f){const k=await o.files.create({file:p,purpose:"assistants"},s);l.push(k.id)}}const d=Array(i).fill(c).map(u);return await _o(d),await this.createAndPoll(e,{file_ids:l})}}class Fe extends P{constructor(){super(...arguments),this.files=new $n(this._client),this.fileBatches=new Va(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/vector_stores",qr,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,Jr,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class qr extends Y{}class Jr extends Cn{}Fe.VectorStoresPage=qr;Fe.VectorStoreSearchResponsesPage=Jr;Fe.Files=$n;Fe.VectorStoreFilesPage=Nn;Fe.FileContentResponsesPage=Wr;Fe.FileBatches=Va;var yo={},za;class E extends ji{constructor({baseURL:e=Ve("OPENAI_BASE_URL"),apiKey:t=Ve("OPENAI_API_KEY"),organization:n=Ve("OPENAI_ORG_ID")??null,project:s=Ve("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new x("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&qi())throw new x(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Oa(this),this.chat=new Tn(this),this.embeddings=new $a(this),this.files=new Tr(this),this.images=new Za(this),this.audio=new Vt(this),this.moderations=new Da(this),this.models=new Lr(this),this.fineTuning=new De(this),this.graders=new Fr(this),this.vectorStores=new Fe(this),this.beta=new mt(this),this.batches=new mr(this),this.uploads=new zr(this),this.responses=new Vr(this),this.evals=new Jt(this),this._options=i,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return yi(e,{arrayFormat:"brackets"})}}za=E;E.OpenAI=za;E.DEFAULT_TIMEOUT=6e5;E.OpenAIError=x;E.APIError=Q;E.APIConnectionError=kn;E.APIConnectionTimeoutError=fr;E.APIUserAbortError=le;E.NotFoundError=Vs;E.ConflictError=zs;E.RateLimitError=qs;E.BadRequestError=Ls;E.AuthenticationError=Bs;E.InternalServerError=Js;E.PermissionDeniedError=Us;E.UnprocessableEntityError=Ws;E.toFile=Ys;E.fileFromPath=Zs;E.Completions=Oa;E.Chat=Tn;E.ChatCompletionsPage=En;E.Embeddings=$a;E.Files=Tr;E.FileObjectsPage=Ir;E.Images=Za;E.Audio=Vt;E.Moderations=Da;E.Models=Lr;E.ModelsPage=Br;E.FineTuning=De;E.Graders=Fr;E.VectorStores=Fe;E.VectorStoresPage=qr;E.VectorStoreSearchResponsesPage=Jr;E.Beta=mt;E.Batches=mr;E.BatchesPage=pr;E.Uploads=zr;E.Responses=Vr;E.Evals=Jt;E.EvalListResponsesPage=Er;class wo extends E{constructor({baseURL:e=Ve("OPENAI_BASE_URL"),apiKey:t=Ve("AZURE_OPENAI_API_KEY"),apiVersion:n=Ve("OPENAI_API_VERSION"),endpoint:s,deployment:a,azureADTokenProvider:i,dangerouslyAllowBrowser:o,...c}={}){if(!n)throw new x("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if(typeof i=="function"&&(o=!0),!i&&!t)throw new x("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(i&&t)throw new x("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(t??(t=ws),c.defaultQuery={...c.defaultQuery,"api-version":n},e){if(s)throw new x("baseURL and endpoint are mutually exclusive")}else{if(s||(s=yo.AZURE_OPENAI_ENDPOINT),!s)throw new x("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");e=`${s}/openai`}super({apiKey:t,baseURL:e,...c,...o!==void 0?{dangerouslyAllowBrowser:o}:{}}),this.apiVersion="",this._azureADTokenProvider=i,this.apiVersion=n,this.deploymentName=a}buildRequest(e,t={}){var n;if(vo.has(e.path)&&e.method==="post"&&e.body!==void 0){if(!rn(e.body))throw new Error("Expected request body to be an object");const s=this.deploymentName||e.body.model||((n=e.__metadata)==null?void 0:n.model);s!==void 0&&!this.baseURL.includes("/deployments")&&(e.path=`/deployments/${s}${e.path}`)}return super.buildRequest(e,t)}async _getAzureADToken(){if(typeof this._azureADTokenProvider=="function"){const e=await this._azureADTokenProvider();if(!e||typeof e!="string")throw new x(`Expected 'azureADTokenProvider' argument to return a string but it returned ${e}`);return e}}authHeaders(e){return{}}async prepareOptions(e){var n;if((n=e.headers)!=null&&n["api-key"])return super.prepareOptions(e);const t=await this._getAzureADToken();if(e.headers??(e.headers={}),t)e.headers.Authorization=`Bearer ${t}`;else if(this.apiKey!==ws)e.headers["api-key"]=this.apiKey;else throw new x("Unable to handle auth");return super.prepareOptions(e)}}const vo=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]),ws="<Missing Key>",bo=Symbol("Let zodToJsonSchema decide on which parser to use"),vs={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},xo=r=>typeof r=="string"?{...vs,basePath:["#"],definitions:{},name:r}:{...vs,basePath:["#"],definitions:{},...r},cr=r=>"_def"in r?r._def:r;function ko(r){if(!r)return!0;for(const e in r)return!1;return!0}const So=r=>{const e=xo(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[cr(s),{def:cr(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Wa(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function j(r,e,t,n,s){r[e]=t,Wa(r,e,n,s)}var O;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},r.getValidEnumValues=s=>{const a=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return r.objectValues(i)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},r.find=(s,a)=>{for(const i of s)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=n,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(O||(O={}));var lr;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(lr||(lr={}));const _=O.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Re=r=>{switch(typeof r){case"undefined":return _.undefined;case"string":return _.string;case"number":return isNaN(r)?_.nan:_.number;case"boolean":return _.boolean;case"function":return _.function;case"bigint":return _.bigint;case"symbol":return _.symbol;case"object":return Array.isArray(r)?_.array:r===null?_.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?_.promise:typeof Map<"u"&&r instanceof Map?_.map:typeof Set<"u"&&r instanceof Set?_.set:typeof Date<"u"&&r instanceof Date?_.date:_.object;default:return _.unknown}},h=O.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Ao=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class oe extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let o=n,c=0;for(;c<i.path.length;){const l=i.path[c];c===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(i))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return s(this),n}static assert(e){if(!(e instanceof oe))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,O.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}oe.create=r=>new oe(r);const ut=(r,e)=>{let t;switch(r.code){case h.invalid_type:r.received===_.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case h.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,O.jsonStringifyReplacer)}`;break;case h.unrecognized_keys:t=`Unrecognized key(s) in object: ${O.joinValues(r.keys,", ")}`;break;case h.invalid_union:t="Invalid input";break;case h.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${O.joinValues(r.options)}`;break;case h.invalid_enum_value:t=`Invalid enum value. Expected ${O.joinValues(r.options)}, received '${r.received}'`;break;case h.invalid_arguments:t="Invalid function arguments";break;case h.invalid_return_type:t="Invalid function return type";break;case h.invalid_date:t="Invalid date";break;case h.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:O.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case h.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case h.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case h.custom:t="Invalid input";break;case h.invalid_intersection_types:t="Intersection results could not be merged";break;case h.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case h.not_finite:t="Number must be finite";break;default:t=e.defaultError,O.assertNever(r)}return{message:t}};let qa=ut;function Po(r){qa=r}function pn(){return qa}const gn=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const c=n.filter(l=>!!l).slice().reverse();for(const l of c)o=l(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},Co=[];function g(r,e){const t=pn(),n=gn({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===ut?void 0:ut].filter(s=>!!s)});r.common.issues.push(n)}class te{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return A;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const a=await s.key,i=await s.value;n.push({key:a,value:i})}return te.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return A;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}}const A=Object.freeze({status:"aborted"}),st=r=>({status:"dirty",value:r}),ne=r=>({status:"valid",value:r}),ur=r=>r.status==="aborted",dr=r=>r.status==="dirty",qe=r=>r.status==="valid",Et=r=>typeof Promise<"u"&&r instanceof Promise;function _n(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function Ja(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var y;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(y||(y={}));var kt,St;class ke{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const bs=(r,e)=>{if(qe(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new oe(r.common.issues);return this._error=t,this._error}}};function R(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{var c,l;const{message:u}=r;return i.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(c=u??n)!==null&&c!==void 0?c:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(l=u??t)!==null&&l!==void 0?l:o.defaultError}},description:s}}class T{get description(){return this._def.description}_getType(e){return Re(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Re(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new te,ctx:{common:e.parent.common,data:e.data,parsedType:Re(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Et(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Re(e)},a=this._parseSync({data:e,path:s.path,parent:s});return bs(s,a)}"~validate"(e){var t,n;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Re(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:s});return qe(a)?{value:a.value}:{issues:s.common.issues}}catch(a){!((n=(t=a==null?void 0:a.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(a=>qe(a)?{value:a.value}:{issues:s.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Re(e)},s=this._parse({data:e,path:n.path,parent:n}),a=await(Et(s)?s:Promise.resolve(s));return bs(n,a)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:h.custom,...n(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new _e({schema:this,typeName:m.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return xe.create(this,this._def)}nullable(){return Ze.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ge.create(this)}promise(){return ht.create(this,this._def)}or(e){return $t.create([this,e],this._def)}and(e){return Nt.create(this,e,this._def)}transform(e){return new _e({...R(this._def),schema:this,typeName:m.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Ft({...R(this._def),innerType:this,defaultValue:t,typeName:m.ZodDefault})}brand(){return new Hr({typeName:m.ZodBranded,type:this,...R(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Lt({...R(this._def),innerType:this,catchValue:t,typeName:m.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ht.create(this,e)}readonly(){return Bt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ro=/^c[^\s-]{8,}$/i,Eo=/^[0-9a-z]+$/,To=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Io=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Oo=/^[a-z0-9_-]{21}$/i,$o=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,No=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Mo=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,jo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let qn;const Zo=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Do=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Fo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Lo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Bo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Uo=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ha="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Vo=new RegExp(`^${Ha}$`);function Xa(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);const t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function zo(r){return new RegExp(`^${Xa(r)}$`)}function Ka(r){let e=`${Ha}T${Xa(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Wo(r,e){return!!((e==="v4"||!e)&&Zo.test(r)||(e==="v6"||!e)&&Fo.test(r))}function qo(r,e){if(!$o.test(r))return!1;try{const[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function Jo(r,e){return!!((e==="v4"||!e)&&Do.test(r)||(e==="v6"||!e)&&Lo.test(r))}class pe extends T{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==_.string){const a=this._getOrReturnCtx(e);return g(a,{code:h.invalid_type,expected:_.string,received:a.parsedType}),A}const n=new te;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),g(s,{code:h.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),g(s,{code:h.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?g(s,{code:h.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&g(s,{code:h.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")Mo.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"email",code:h.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qn||(qn=new RegExp(jo,"u")),qn.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"emoji",code:h.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")Io.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"uuid",code:h.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")Oo.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"nanoid",code:h.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")Ro.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"cuid",code:h.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Eo.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"cuid2",code:h.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")To.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"ulid",code:h.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),g(s,{validation:"url",code:h.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"regex",code:h.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),g(s,{code:h.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),g(s,{code:h.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),g(s,{code:h.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?Ka(a).test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{code:h.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?Vo.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{code:h.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?zo(a).test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{code:h.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?No.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"duration",code:h.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?Wo(e.data,a.version)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"ip",code:h.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?qo(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"jwt",code:h.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?Jo(e.data,a.version)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"cidr",code:h.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?Bo.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"base64",code:h.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?Uo.test(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{validation:"base64url",code:h.invalid_string,message:a.message}),n.dirty()):O.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:h.invalid_string,...y.errToObj(n)})}_addCheck(e){return new pe({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...y.errToObj(e)})}url(e){return this._addCheck({kind:"url",...y.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...y.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...y.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...y.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...y.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...y.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...y.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...y.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...y.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...y.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...y.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...y.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...y.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...y.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...y.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...y.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...y.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...y.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...y.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...y.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...y.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...y.errToObj(t)})}nonempty(e){return this.min(1,y.errToObj(e))}trim(){return new pe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new pe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new pe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}pe.create=r=>{var e;return new pe({checks:[],typeName:m.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...R(r)})};function Ho(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,a=parseInt(r.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return a%i/Math.pow(10,s)}class Ne extends T{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==_.number){const a=this._getOrReturnCtx(e);return g(a,{code:h.invalid_type,expected:_.number,received:a.parsedType}),A}let n;const s=new te;for(const a of this._def.checks)a.kind==="int"?O.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:h.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),g(n,{code:h.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),g(n,{code:h.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?Ho(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),g(n,{code:h.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:h.not_finite,message:a.message}),s.dirty()):O.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,y.toString(t))}gt(e,t){return this.setLimit("min",e,!1,y.toString(t))}lte(e,t){return this.setLimit("max",e,!0,y.toString(t))}lt(e,t){return this.setLimit("max",e,!1,y.toString(t))}setLimit(e,t,n,s){return new Ne({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:y.toString(s)}]})}_addCheck(e){return new Ne({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:y.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:y.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:y.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:y.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:y.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:y.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:y.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:y.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:y.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&O.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ne.create=r=>new Ne({checks:[],typeName:m.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...R(r)});class Me extends T{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==_.bigint)return this._getInvalidInput(e);let n;const s=new te;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),g(n,{code:h.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),g(n,{code:h.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),g(n,{code:h.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):O.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return g(t,{code:h.invalid_type,expected:_.bigint,received:t.parsedType}),A}gte(e,t){return this.setLimit("min",e,!0,y.toString(t))}gt(e,t){return this.setLimit("min",e,!1,y.toString(t))}lte(e,t){return this.setLimit("max",e,!0,y.toString(t))}lt(e,t){return this.setLimit("max",e,!1,y.toString(t))}setLimit(e,t,n,s){return new Me({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:y.toString(s)}]})}_addCheck(e){return new Me({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:y.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:y.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:y.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:y.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:y.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Me.create=r=>{var e;return new Me({checks:[],typeName:m.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...R(r)})};class Tt extends T{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==_.boolean){const n=this._getOrReturnCtx(e);return g(n,{code:h.invalid_type,expected:_.boolean,received:n.parsedType}),A}return ne(e.data)}}Tt.create=r=>new Tt({typeName:m.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...R(r)});class Je extends T{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==_.date){const a=this._getOrReturnCtx(e);return g(a,{code:h.invalid_type,expected:_.date,received:a.parsedType}),A}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return g(a,{code:h.invalid_date}),A}const n=new te;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),g(s,{code:h.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),g(s,{code:h.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):O.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Je({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:y.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:y.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Je.create=r=>new Je({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:m.ZodDate,...R(r)});class yn extends T{_parse(e){if(this._getType(e)!==_.symbol){const n=this._getOrReturnCtx(e);return g(n,{code:h.invalid_type,expected:_.symbol,received:n.parsedType}),A}return ne(e.data)}}yn.create=r=>new yn({typeName:m.ZodSymbol,...R(r)});class It extends T{_parse(e){if(this._getType(e)!==_.undefined){const n=this._getOrReturnCtx(e);return g(n,{code:h.invalid_type,expected:_.undefined,received:n.parsedType}),A}return ne(e.data)}}It.create=r=>new It({typeName:m.ZodUndefined,...R(r)});class Ot extends T{_parse(e){if(this._getType(e)!==_.null){const n=this._getOrReturnCtx(e);return g(n,{code:h.invalid_type,expected:_.null,received:n.parsedType}),A}return ne(e.data)}}Ot.create=r=>new Ot({typeName:m.ZodNull,...R(r)});class dt extends T{constructor(){super(...arguments),this._any=!0}_parse(e){return ne(e.data)}}dt.create=r=>new dt({typeName:m.ZodAny,...R(r)});class We extends T{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ne(e.data)}}We.create=r=>new We({typeName:m.ZodUnknown,...R(r)});class Ee extends T{_parse(e){const t=this._getOrReturnCtx(e);return g(t,{code:h.invalid_type,expected:_.never,received:t.parsedType}),A}}Ee.create=r=>new Ee({typeName:m.ZodNever,...R(r)});class wn extends T{_parse(e){if(this._getType(e)!==_.undefined){const n=this._getOrReturnCtx(e);return g(n,{code:h.invalid_type,expected:_.void,received:n.parsedType}),A}return ne(e.data)}}wn.create=r=>new wn({typeName:m.ZodVoid,...R(r)});class ge extends T{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==_.array)return g(t,{code:h.invalid_type,expected:_.array,received:t.parsedType}),A;if(s.exactLength!==null){const i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(g(t,{code:i?h.too_big:h.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(g(t,{code:h.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(g(t,{code:h.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new ke(t,i,t.path,o)))).then(i=>te.mergeArray(n,i));const a=[...t.data].map((i,o)=>s.type._parseSync(new ke(t,i,t.path,o)));return te.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new ge({...this._def,minLength:{value:e,message:y.toString(t)}})}max(e,t){return new ge({...this._def,maxLength:{value:e,message:y.toString(t)}})}length(e,t){return new ge({...this._def,exactLength:{value:e,message:y.toString(t)}})}nonempty(e){return this.min(1,e)}}ge.create=(r,e)=>new ge({type:r,minLength:null,maxLength:null,exactLength:null,typeName:m.ZodArray,...R(e)});function nt(r){if(r instanceof L){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=xe.create(nt(n))}return new L({...r._def,shape:()=>e})}else return r instanceof ge?new ge({...r._def,type:nt(r.element)}):r instanceof xe?xe.create(nt(r.unwrap())):r instanceof Ze?Ze.create(nt(r.unwrap())):r instanceof Se?Se.create(r.items.map(e=>nt(e))):r}class L extends T{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=O.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==_.object){const l=this._getOrReturnCtx(e);return g(l,{code:h.invalid_type,expected:_.object,received:l.parsedType}),A}const{status:n,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ee&&this._def.unknownKeys==="strip"))for(const l in s.data)i.includes(l)||o.push(l);const c=[];for(const l of i){const u=a[l],d=s.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new ke(s,d,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof Ee){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of o)c.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(l==="strict")o.length>0&&(g(s,{code:h.unrecognized_keys,keys:o}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of o){const d=s.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new ke(s,d,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of c){const d=await u.key,f=await u.value;l.push({key:d,value:f,alwaysSet:u.alwaysSet})}return l}).then(l=>te.mergeObjectSync(n,l)):te.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return y.errToObj,new L({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,a,i,o;const c=(i=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,t,n).message)!==null&&i!==void 0?i:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=y.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new L({...this._def,unknownKeys:"strip"})}passthrough(){return new L({...this._def,unknownKeys:"passthrough"})}extend(e){return new L({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new L({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:m.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new L({...this._def,catchall:e})}pick(e){const t={};return O.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new L({...this._def,shape:()=>t})}omit(e){const t={};return O.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new L({...this._def,shape:()=>t})}deepPartial(){return nt(this)}partial(e){const t={};return O.objectKeys(this.shape).forEach(n=>{const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new L({...this._def,shape:()=>t})}required(e){const t={};return O.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof xe;)a=a._def.innerType;t[n]=a}}),new L({...this._def,shape:()=>t})}keyof(){return Ga(O.objectKeys(this.shape))}}L.create=(r,e)=>new L({shape:()=>r,unknownKeys:"strip",catchall:Ee.create(),typeName:m.ZodObject,...R(e)});L.strictCreate=(r,e)=>new L({shape:()=>r,unknownKeys:"strict",catchall:Ee.create(),typeName:m.ZodObject,...R(e)});L.lazycreate=(r,e)=>new L({shape:r,unknownKeys:"strip",catchall:Ee.create(),typeName:m.ZodObject,...R(e)});class $t extends T{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new oe(o.ctx.common.issues));return g(t,{code:h.invalid_union,unionErrors:i}),A}if(t.common.async)return Promise.all(n.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const c of n){const l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!a&&(a={result:u,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(c=>new oe(c));return g(t,{code:h.invalid_union,unionErrors:o}),A}}get options(){return this._def.options}}$t.create=(r,e)=>new $t({options:r,typeName:m.ZodUnion,...R(e)});const Ce=r=>r instanceof jt?Ce(r.schema):r instanceof _e?Ce(r.innerType()):r instanceof Zt?[r.value]:r instanceof je?r.options:r instanceof Dt?O.objectValues(r.enum):r instanceof Ft?Ce(r._def.innerType):r instanceof It?[void 0]:r instanceof Ot?[null]:r instanceof xe?[void 0,...Ce(r.unwrap())]:r instanceof Ze?[null,...Ce(r.unwrap())]:r instanceof Hr||r instanceof Bt?Ce(r.unwrap()):r instanceof Lt?Ce(r._def.innerType):[];class Mn extends T{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.object)return g(t,{code:h.invalid_type,expected:_.object,received:t.parsedType}),A;const n=this.discriminator,s=t.data[n],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(g(t,{code:h.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),A)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const a of t){const i=Ce(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new Mn({typeName:m.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...R(n)})}}function hr(r,e){const t=Re(r),n=Re(e);if(r===e)return{valid:!0,data:r};if(t===_.object&&n===_.object){const s=O.objectKeys(e),a=O.objectKeys(r).filter(o=>s.indexOf(o)!==-1),i={...r,...e};for(const o of a){const c=hr(r[o],e[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(t===_.array&&n===_.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],c=hr(i,o);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return t===_.date&&n===_.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Nt extends T{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(a,i)=>{if(ur(a)||ur(i))return A;const o=hr(a.value,i.value);return o.valid?((dr(a)||dr(i))&&t.dirty(),{status:t.value,value:o.data}):(g(n,{code:h.invalid_intersection_types}),A)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Nt.create=(r,e,t)=>new Nt({left:r,right:e,typeName:m.ZodIntersection,...R(t)});class Se extends T{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==_.array)return g(n,{code:h.invalid_type,expected:_.array,received:n.parsedType}),A;if(n.data.length<this._def.items.length)return g(n,{code:h.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),A;!this._def.rest&&n.data.length>this._def.items.length&&(g(n,{code:h.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new ke(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(a).then(i=>te.mergeArray(t,i)):te.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Se({...this._def,rest:e})}}Se.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Se({items:r,typeName:m.ZodTuple,rest:null,...R(e)})};class Mt extends T{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==_.object)return g(n,{code:h.invalid_type,expected:_.object,received:n.parsedType}),A;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in n.data)s.push({key:a._parse(new ke(n,o,n.path,o)),value:i._parse(new ke(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?te.mergeObjectAsync(t,s):te.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof T?new Mt({keyType:e,valueType:t,typeName:m.ZodRecord,...R(n)}):new Mt({keyType:pe.create(),valueType:e,typeName:m.ZodRecord,...R(t)})}}class vn extends T{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==_.map)return g(n,{code:h.invalid_type,expected:_.map,received:n.parsedType}),A;const s=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map(([o,c],l)=>({key:s._parse(new ke(n,o,n.path,[l,"key"])),value:a._parse(new ke(n,c,n.path,[l,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return A;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of i){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return A;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}}}}vn.create=(r,e,t)=>new vn({valueType:e,keyType:r,typeName:m.ZodMap,...R(t)});class He extends T{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==_.set)return g(n,{code:h.invalid_type,expected:_.set,received:n.parsedType}),A;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(g(n,{code:h.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(g(n,{code:h.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const a=this._def.valueType;function i(c){const l=new Set;for(const u of c){if(u.status==="aborted")return A;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}const o=[...n.data.values()].map((c,l)=>a._parse(new ke(n,c,n.path,l)));return n.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,t){return new He({...this._def,minSize:{value:e,message:y.toString(t)}})}max(e,t){return new He({...this._def,maxSize:{value:e,message:y.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}He.create=(r,e)=>new He({valueType:r,minSize:null,maxSize:null,typeName:m.ZodSet,...R(e)});class ct extends T{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.function)return g(t,{code:h.invalid_type,expected:_.function,received:t.parsedType}),A;function n(o,c){return gn({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,pn(),ut].filter(l=>!!l),issueData:{code:h.invalid_arguments,argumentsError:c}})}function s(o,c){return gn({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,pn(),ut].filter(l=>!!l),issueData:{code:h.invalid_return_type,returnTypeError:c}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof ht){const o=this;return ne(async function(...c){const l=new oe([]),u=await o._def.args.parseAsync(c,a).catch(p=>{throw l.addIssue(n(c,p)),l}),d=await Reflect.apply(i,this,u);return await o._def.returns._def.type.parseAsync(d,a).catch(p=>{throw l.addIssue(s(d,p)),l})})}else{const o=this;return ne(function(...c){const l=o._def.args.safeParse(c,a);if(!l.success)throw new oe([n(c,l.error)]);const u=Reflect.apply(i,this,l.data),d=o._def.returns.safeParse(u,a);if(!d.success)throw new oe([s(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ct({...this._def,args:Se.create(e).rest(We.create())})}returns(e){return new ct({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new ct({args:e||Se.create([]).rest(We.create()),returns:t||We.create(),typeName:m.ZodFunction,...R(n)})}}class jt extends T{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}jt.create=(r,e)=>new jt({getter:r,typeName:m.ZodLazy,...R(e)});class Zt extends T{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return g(t,{received:t.data,code:h.invalid_literal,expected:this._def.value}),A}return{status:"valid",value:e.data}}get value(){return this._def.value}}Zt.create=(r,e)=>new Zt({value:r,typeName:m.ZodLiteral,...R(e)});function Ga(r,e){return new je({values:r,typeName:m.ZodEnum,...R(e)})}class je extends T{constructor(){super(...arguments),kt.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return g(t,{expected:O.joinValues(n),received:t.parsedType,code:h.invalid_type}),A}if(_n(this,kt)||Ja(this,kt,new Set(this._def.values)),!_n(this,kt).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return g(t,{received:t.data,code:h.invalid_enum_value,options:n}),A}return ne(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return je.create(e,{...this._def,...t})}exclude(e,t=this._def){return je.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}kt=new WeakMap;je.create=Ga;class Dt extends T{constructor(){super(...arguments),St.set(this,void 0)}_parse(e){const t=O.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==_.string&&n.parsedType!==_.number){const s=O.objectValues(t);return g(n,{expected:O.joinValues(s),received:n.parsedType,code:h.invalid_type}),A}if(_n(this,St)||Ja(this,St,new Set(O.getValidEnumValues(this._def.values))),!_n(this,St).has(e.data)){const s=O.objectValues(t);return g(n,{received:n.data,code:h.invalid_enum_value,options:s}),A}return ne(e.data)}get enum(){return this._def.values}}St=new WeakMap;Dt.create=(r,e)=>new Dt({values:r,typeName:m.ZodNativeEnum,...R(e)});class ht extends T{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.promise&&t.common.async===!1)return g(t,{code:h.invalid_type,expected:_.promise,received:t.parsedType}),A;const n=t.parsedType===_.promise?t.data:Promise.resolve(t.data);return ne(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ht.create=(r,e)=>new ht({type:r,typeName:m.ZodPromise,...R(e)});class _e extends T{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===m.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{g(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(n.data,a);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return A;const c=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return c.status==="aborted"?A:c.status==="dirty"||t.value==="dirty"?st(c.value):c});{if(t.value==="aborted")return A;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?A:o.status==="dirty"||t.value==="dirty"?st(o.value):o}}if(s.type==="refinement"){const i=o=>{const c=s.refinement(o,a);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?A:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?A:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!qe(i))return i;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>qe(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):i);O.assertNever(s)}}_e.create=(r,e,t)=>new _e({schema:r,typeName:m.ZodEffects,effect:e,...R(t)});_e.createWithPreprocess=(r,e,t)=>new _e({schema:e,effect:{type:"preprocess",transform:r},typeName:m.ZodEffects,...R(t)});class xe extends T{_parse(e){return this._getType(e)===_.undefined?ne(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}xe.create=(r,e)=>new xe({innerType:r,typeName:m.ZodOptional,...R(e)});class Ze extends T{_parse(e){return this._getType(e)===_.null?ne(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ze.create=(r,e)=>new Ze({innerType:r,typeName:m.ZodNullable,...R(e)});class Ft extends T{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===_.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ft.create=(r,e)=>new Ft({innerType:r,typeName:m.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...R(e)});class Lt extends T{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Et(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new oe(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new oe(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Lt.create=(r,e)=>new Lt({innerType:r,typeName:m.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...R(e)});class bn extends T{_parse(e){if(this._getType(e)!==_.nan){const n=this._getOrReturnCtx(e);return g(n,{code:h.invalid_type,expected:_.nan,received:n.parsedType}),A}return{status:"valid",value:e.data}}}bn.create=r=>new bn({typeName:m.ZodNaN,...R(r)});const Xo=Symbol("zod_brand");class Hr extends T{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ht extends T{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?A:a.status==="dirty"?(t.dirty(),st(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?A:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new Ht({in:e,out:t,typeName:m.ZodPipeline})}}class Bt extends T{_parse(e){const t=this._def.innerType._parse(e),n=s=>(qe(s)&&(s.value=Object.freeze(s.value)),s);return Et(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}Bt.create=(r,e)=>new Bt({innerType:r,typeName:m.ZodReadonly,...R(e)});function xs(r,e){const t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Qa(r,e={},t){return r?dt.create().superRefine((n,s)=>{var a,i;const o=r(n);if(o instanceof Promise)return o.then(c=>{var l,u;if(!c){const d=xs(e,n),f=(u=(l=d.fatal)!==null&&l!==void 0?l:t)!==null&&u!==void 0?u:!0;s.addIssue({code:"custom",...d,fatal:f})}});if(!o){const c=xs(e,n),l=(i=(a=c.fatal)!==null&&a!==void 0?a:t)!==null&&i!==void 0?i:!0;s.addIssue({code:"custom",...c,fatal:l})}}):dt.create()}const Ko={object:L.lazycreate};var m;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(m||(m={}));const Go=(r,e={message:`Input not instance of ${r.name}`})=>Qa(t=>t instanceof r,e),Ya=pe.create,ei=Ne.create,Qo=bn.create,Yo=Me.create,ti=Tt.create,ec=Je.create,tc=yn.create,nc=It.create,rc=Ot.create,sc=dt.create,ac=We.create,ic=Ee.create,oc=wn.create,cc=ge.create,lc=L.create,uc=L.strictCreate,dc=$t.create,hc=Mn.create,fc=Nt.create,mc=Se.create,pc=Mt.create,gc=vn.create,_c=He.create,yc=ct.create,wc=jt.create,vc=Zt.create,bc=je.create,xc=Dt.create,kc=ht.create,ks=_e.create,Sc=xe.create,Ac=Ze.create,Pc=_e.createWithPreprocess,Cc=Ht.create,Rc=()=>Ya().optional(),Ec=()=>ei().optional(),Tc=()=>ti().optional(),Ic={string:r=>pe.create({...r,coerce:!0}),number:r=>Ne.create({...r,coerce:!0}),boolean:r=>Tt.create({...r,coerce:!0}),bigint:r=>Me.create({...r,coerce:!0}),date:r=>Je.create({...r,coerce:!0})},Oc=A;var G=Object.freeze({__proto__:null,defaultErrorMap:ut,setErrorMap:Po,getErrorMap:pn,makeIssue:gn,EMPTY_PATH:Co,addIssueToContext:g,ParseStatus:te,INVALID:A,DIRTY:st,OK:ne,isAborted:ur,isDirty:dr,isValid:qe,isAsync:Et,get util(){return O},get objectUtil(){return lr},ZodParsedType:_,getParsedType:Re,ZodType:T,datetimeRegex:Ka,ZodString:pe,ZodNumber:Ne,ZodBigInt:Me,ZodBoolean:Tt,ZodDate:Je,ZodSymbol:yn,ZodUndefined:It,ZodNull:Ot,ZodAny:dt,ZodUnknown:We,ZodNever:Ee,ZodVoid:wn,ZodArray:ge,ZodObject:L,ZodUnion:$t,ZodDiscriminatedUnion:Mn,ZodIntersection:Nt,ZodTuple:Se,ZodRecord:Mt,ZodMap:vn,ZodSet:He,ZodFunction:ct,ZodLazy:jt,ZodLiteral:Zt,ZodEnum:je,ZodNativeEnum:Dt,ZodPromise:ht,ZodEffects:_e,ZodTransformer:_e,ZodOptional:xe,ZodNullable:Ze,ZodDefault:Ft,ZodCatch:Lt,ZodNaN:bn,BRAND:Xo,ZodBranded:Hr,ZodPipeline:Ht,ZodReadonly:Bt,custom:Qa,Schema:T,ZodSchema:T,late:Ko,get ZodFirstPartyTypeKind(){return m},coerce:Ic,any:sc,array:cc,bigint:Yo,boolean:ti,date:ec,discriminatedUnion:hc,effect:ks,enum:bc,function:yc,instanceof:Go,intersection:fc,lazy:wc,literal:vc,map:gc,nan:Qo,nativeEnum:xc,never:ic,null:rc,nullable:Ac,number:ei,object:lc,oboolean:Tc,onumber:Ec,optional:Sc,ostring:Rc,pipeline:Cc,preprocess:Pc,promise:kc,record:pc,set:_c,strictObject:uc,string:Ya,symbol:tc,transformer:ks,tuple:mc,undefined:nc,union:dc,unknown:ac,void:oc,NEVER:Oc,ZodIssueCode:h,quotelessJson:Ao,ZodError:oe});function $c(){return{}}function Nc(r,e){var n,s;const t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==m.ZodAny&&(t.items=N(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&j(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&j(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(j(t,"minItems",r.exactLength.value,r.exactLength.message,e),j(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function Mc(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?j(t,"minimum",n.value,n.message,e):j(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),j(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?j(t,"maximum",n.value,n.message,e):j(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),j(t,"maximum",n.value,n.message,e));break;case"multipleOf":j(t,"multipleOf",n.value,n.message,e);break}return t}function jc(){return{type:"boolean"}}function Zc(r,e){return N(r.type._def,e)}const Dc=(r,e)=>N(r.innerType._def,e);function ni(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>ni(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Fc(r,e)}}const Fc=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":j(t,"minimum",n.value,n.message,e);break;case"max":j(t,"maximum",n.value,n.message,e);break}return t};function Lc(r,e){return{...N(r.innerType._def,e),default:r.defaultValue()}}function Bc(r,e,t){return e.effectStrategy==="input"?N(r.schema._def,e,t):{}}function Uc(r){return{type:"string",enum:[...r.values]}}const Vc=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function zc(r,e){const t=[N(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),N(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(a=>{if(Vc(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...c}=a;i=c}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function Wc(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let Jn;const Be={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Jn===void 0&&(Jn=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Jn),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function ri(r,e){const t={type:"string"};function n(s){return e.patternStrategy==="escape"?qc(s):s}if(r.checks)for(const s of r.checks)switch(s.kind){case"min":j(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":j(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":ue(t,"email",s.message,e);break;case"format:idn-email":ue(t,"idn-email",s.message,e);break;case"pattern:zod":de(t,Be.email,s.message,e);break}break;case"url":ue(t,"uri",s.message,e);break;case"uuid":ue(t,"uuid",s.message,e);break;case"regex":de(t,s.regex,s.message,e);break;case"cuid":de(t,Be.cuid,s.message,e);break;case"cuid2":de(t,Be.cuid2,s.message,e);break;case"startsWith":de(t,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":de(t,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":ue(t,"date-time",s.message,e);break;case"date":ue(t,"date",s.message,e);break;case"time":ue(t,"time",s.message,e);break;case"duration":ue(t,"duration",s.message,e);break;case"length":j(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),j(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{de(t,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&ue(t,"ipv4",s.message,e),s.version!=="v4"&&ue(t,"ipv6",s.message,e);break}case"emoji":de(t,Be.emoji,s.message,e);break;case"ulid":{de(t,Be.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{ue(t,"binary",s.message,e);break}case"contentEncoding:base64":{j(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{de(t,Be.base64,s.message,e);break}}break}case"nanoid":de(t,Be.nanoid,s.message,e)}return t}const qc=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),ue=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(a=>a.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):j(r,"format",e,t,n)},de=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(a=>a.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Ss(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):j(r,"pattern",Ss(e,n),t,n)},Ss=(r,e)=>{var l;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=n.i?t.source.toLowerCase():t.source;let a="",i=!1,o=!1,c=!1;for(let u=0;u<s.length;u++){if(i){a+=s[u],i=!1;continue}if(n.i){if(o){if(s[u].match(/[a-z]/)){c?(a+=s[u],a+=`${s[u-2]}-${s[u]}`.toUpperCase(),c=!1):s[u+1]==="-"&&((l=s[u+2])!=null&&l.match(/[a-z]/))?(a+=s[u],c=!0):a+=`${s[u]}${s[u].toUpperCase()}`;continue}}else if(s[u].match(/[a-z]/)){a+=`[${s[u]}${s[u].toUpperCase()}]`;continue}}if(n.m){if(s[u]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(s[u]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&s[u]==="."){a+=o?`${s[u]}\r
`:`[${s[u]}\r
]`;continue}a+=s[u],s[u]==="\\"?i=!0:o&&s[u]==="]"?o=!1:!o&&s[u]==="["&&(o=!0)}try{const u=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return a};function si(r,e){var n,s,a,i;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===m.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((o,c)=>({...o,[c]:N(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:N(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===m.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){const o=Object.entries(ri(r.keyType._def,e)).reduce((c,[l,u])=>l==="type"?c:{...c,[l]:u},{});return{...t,propertyNames:o}}else if(((i=r.keyType)==null?void 0:i._def.typeName)===m.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function Jc(r,e){if(e.mapStrategy==="record")return si(r,e);const t=N(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=N(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function Hc(r){const e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function Xc(){return{not:{}}}function Kc(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const xn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Gc(r,e){if(e.target==="openApi3")return As(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in xn&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,a)=>{const i=xn[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return As(r,e)}const As=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>N(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function Qc(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:xn[r.innerType._def.typeName],nullable:!0}:{type:[xn[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=N(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=N(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Yc(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",Wa(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?j(t,"minimum",n.value,n.message,e):j(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),j(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?j(t,"maximum",n.value,n.message,e):j(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),j(t,"maximum",n.value,n.message,e));break;case"multipleOf":j(t,"multipleOf",n.value,n.message,e);break}return t}function el(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":N(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":N(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function tl(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((n,[s,a])=>{if(a===void 0||a._def===void 0)return n;const i=[...e.currentPath,"properties",s],o=N(a._def,{...e,currentPath:i,propertyPath:i});return o===void 0?n:(e.openaiStrictMode&&a.isOptional()&&!a.isNullable()&&console.warn(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required
This will become an error in a future version of the SDK.`),{properties:{...n.properties,[s]:o},required:a.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]})},{properties:{},required:[]}),additionalProperties:el(r,e)};return t.required.length||delete t.required,t}const nl=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return N(r.innerType._def,e);const t=N(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},rl=(r,e)=>{if(e.pipeStrategy==="input")return N(r.in._def,e);if(e.pipeStrategy==="output")return N(r.out._def,e);const t=N(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=N(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function sl(r,e){return N(r.type._def,e)}function al(r,e){const n={type:"array",uniqueItems:!0,items:N(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&j(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&j(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function il(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>N(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:N(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>N(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function ol(){return{not:{}}}function cl(){return{}}const ll=(r,e)=>N(r.innerType._def,e);function N(r,e,t=!1){var i;const n=e.seen.get(r);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,r,e,n,t);if(o!==bo)return o}if(n&&!t){const o=ul(n,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const a=hl(r,r.typeName,e,t);return a&&fl(r,e,a),s.jsonSchema=a,a}const ul=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:dl(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},dl=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},hl=(r,e,t,n)=>{switch(e){case m.ZodString:return ri(r,t);case m.ZodNumber:return Yc(r,t);case m.ZodObject:return tl(r,t);case m.ZodBigInt:return Mc(r,t);case m.ZodBoolean:return jc();case m.ZodDate:return ni(r,t);case m.ZodUndefined:return ol();case m.ZodNull:return Kc(t);case m.ZodArray:return Nc(r,t);case m.ZodUnion:case m.ZodDiscriminatedUnion:return Gc(r,t);case m.ZodIntersection:return zc(r,t);case m.ZodTuple:return il(r,t);case m.ZodRecord:return si(r,t);case m.ZodLiteral:return Wc(r,t);case m.ZodEnum:return Uc(r);case m.ZodNativeEnum:return Hc(r);case m.ZodNullable:return Qc(r,t);case m.ZodOptional:return nl(r,t);case m.ZodMap:return Jc(r,t);case m.ZodSet:return al(r,t);case m.ZodLazy:return N(r.getter()._def,t);case m.ZodPromise:return sl(r,t);case m.ZodNaN:case m.ZodNever:return Xc();case m.ZodEffects:return Bc(r,t,n);case m.ZodAny:return $c();case m.ZodUnknown:return cl();case m.ZodDefault:return Lc(r,t);case m.ZodBranded:return Zc(r,t);case m.ZodReadonly:return ll(r,t);case m.ZodCatch:return Dc(r,t);case m.ZodPipeline:return rl(r,t);case m.ZodFunction:case m.ZodVoid:case m.ZodSymbol:return;default:return(s=>{})()}},fl=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),ml=(r,e)=>{const t=So(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=N(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a);const i=(()=>{if(ko(t.definitions))return;const c={},l=new Set;for(let u=0;u<500;u++){const d=Object.entries(t.definitions).filter(([f])=>!l.has(f));if(d.length===0)break;for(const[f,p]of d)c[f]=N(cr(p),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},l.add(f)}return c})(),o=n===void 0?i?{...s,[t.definitionPath]:i}:s:t.nameStrategy==="duplicate-ref"?{...s,...i||t.seenRefs.size?{[t.definitionPath]:{...i,...t.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...i,[n]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function pl(r,e){return ml(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function ai(r,e,t){return Ki({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:pl(r,{name:e})}},n=>r.parse(JSON.parse(n)))}const X=[];for(let r=0;r<256;++r)X.push((r+256).toString(16).slice(1));function gl(r,e=0){return(X[r[e+0]]+X[r[e+1]]+X[r[e+2]]+X[r[e+3]]+"-"+X[r[e+4]]+X[r[e+5]]+"-"+X[r[e+6]]+X[r[e+7]]+"-"+X[r[e+8]]+X[r[e+9]]+"-"+X[r[e+10]]+X[r[e+11]]+X[r[e+12]]+X[r[e+13]]+X[r[e+14]]+X[r[e+15]]).toLowerCase()}let Hn;const _l=new Uint8Array(16);function yl(){if(!Hn){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Hn=crypto.getRandomValues.bind(crypto)}return Hn(_l)}const wl=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var Ps={randomUUID:wl};function vl(r,e,t){var s;if(Ps.randomUUID&&!r)return Ps.randomUUID();r=r||{};const n=r.random??((s=r.rng)==null?void 0:s.call(r))??yl();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,gl(n)}function ii(r){const e="gpt-4",t="2024-10-21";return new wo({apiKey:r.apiKey,endpoint:r.endpoint,deployment:e,apiVersion:t,dangerouslyAllowBrowser:!0})}G.object({count:G.number().min(5).max(50).default(10).describe("The number of flash cards to generate"),difficulty:G.enum(["mixed","easy","medium","hard"]).default("mixed").describe("The target difficulty level for the cards")});const oi=G.object({question:G.string().describe("The question text for the flash card"),answer:G.string().describe("The answer text for the flash card without page references"),sourcePages:G.array(G.string()).describe("Array of page IDs where this information was found"),pageReferences:G.string().optional().describe("Human-readable text describing the page references"),difficulty:G.enum(["easy","medium","hard"]).describe("The estimated difficulty level of this question"),concepts:G.array(G.string()).describe("Key concepts covered by this flash card")}),bl=G.object({flashcards:G.array(oi).describe("Array of generated flash cards")});function xl(r){const e=[];let s="",a=[],i=[],o=0;for(const c of r.pages){const l=c.text.length*.25;o>0&&o+l>4e3&&(e.push({content:s,pageIds:[...a],pageNumbers:[...i]}),s="",a=[],i=[],o=0),s+=`

--- PAGE ${c.meta.pageNumber||"unknown"} ---

${c.text}`,a.push(c.id),i.push(c.meta.pageNumber),o+=l}return s.length>0&&e.push({content:s,pageIds:a,pageNumbers:i}),e}async function kl(r,e){var s,a;if(!r.pages||r.pages.length<=2)return Math.max(r.pages.length*5,5);const t=Math.min(Math.max(r.pages.length*4,5),50);if(!r.pages.some(i=>i.text&&i.text.trim().length>0))return console.log("No text content found in pages, using default estimate"),t;try{if(!e||!e.endpoint||!e.apiKey)return console.log("Invalid config provided, using default estimate"),t;const i=ii(e),o=Math.min(r.pages.length,2),l=r.pages.slice(0,o).map(f=>f.text||"").join(`

`);if(l.length<50)return console.log("Sample content too small, using default estimate"),t;const u=G.object({estimatedCardCount:G.number().describe("The estimated number of flash cards that could be generated from the full content")});let d;try{const f=new AbortController,p=setTimeout(()=>f.abort(),5e3);d=await i.beta.chat.completions.parse({model:"gpt-4",messages:[{role:"system",content:"You are an expert in educational content analysis. Analyze this sample text and estimate the number of unique flash cards possible from the complete material. The flash cards will have questions in Swedish and answers in the original language of the content."},{role:"user",content:`This is a sample representing ${o} pages out of ${r.pages.length} total pages. Please estimate how many total high-quality, non-duplicate flash cards could be generated from the complete material:

${l}`}],temperature:.2,response_format:ai(u,"estimation")}),clearTimeout(p)}catch(f){return console.error("API call failed:",f),t}if(d&&d.choices&&((a=(s=d.choices[0])==null?void 0:s.message)!=null&&a.parsed)){const f=d.choices[0].message.parsed.estimatedCardCount,p=r.pages.length/o,k=Math.round(f*p);return Math.min(Math.max(k,5),50)}return console.log("No structured response received, using default estimate"),t}catch(i){return console.error("Error estimating flash card count:",i),t}}async function Sl(r,e,t,n){if(!r.pages.length)throw new Error("Cannot generate flash cards: Series contains no pages");const s=ii(e),a=xl(r);n(0,a.length,"Processing content chunks");const i=Math.ceil(t.count/a.length),o=t.count,c=[];for(let d=0;d<a.length;d++){const f=a[d];n(d,a.length,`Processing chunk ${d+1} of ${a.length}`);try{const p=await Al(s,f,i,t.difficulty,r.pages);c.push(...p),n(d+1,a.length,`Generated ${c.length} cards so far`)}catch(p){console.error(`Error generating cards for chunk ${d}:`,p),n(d+1,a.length,`Error with chunk ${d+1}`)}}return Pl(c).slice(0,o).map(d=>({...d,id:vl(),createdAt:new Date().toISOString(),type:"flashcard"}))}async function Al(r,e,t,n,s){var c,l,u,d;const a=new Map;for(let f=0;f<e.pageIds.length;f++)a.set(e.pageIds[f],e.pageNumbers[f]);const i=e.pageIds.map(f=>{const p=a.get(f);return p?`Page ${p} (ID: ${f})`:`Unknown page (ID: ${f})`}).join(`
`),o=`You are an expert educational content creator specializing in generating high-quality flash cards.
Your task is to create ${t} flash cards from the provided content, ensuring:

1. Questions are ALWAYS written in Swedish, regardless of the language of the content
2. Answers are in the original language of the content
3. Questions are clear, concise, and test understanding (not just recall)
4. Answers are comprehensive yet concise, with all key information
5. IMPORTANT: Place page references in the separate "pageReferences" field, NOT in the answer text
6. Cards cover diverse concepts within the material
7. No duplicate or highly similar cards are created
8. Difficulty level is set to: ${n==="mixed"?"a mix of easy, medium, and hard":n}

Important: All questions MUST be in Swedish for Swedish students learning the material, even if the content is in another language. The answers should remain in the original language of the content.

Here are the available page references:
${i}

When citing source pages:
- Use the exact page IDs from this list in the sourcePages array
- Put human-readable page references in the pageReferences field (e.g., "Page 5, Page 10")
- Keep the answer field focused on content without any page references`;try{const f=await r.beta.chat.completions.parse({model:"gpt-4",messages:[{role:"system",content:o},{role:"user",content:`Please create ${t} flash cards from this content, following the guidelines I provided. Remember that all questions MUST be in Swedish, while answers should be in the original language:

${e.content}`}],temperature:.5,response_format:ai(bl,"flashcards")});if((l=(c=f.choices[0])==null?void 0:c.message)!=null&&l.parsed)return f.choices[0].message.parsed.flashcards;throw new Error("No structured response received from Azure OpenAI")}catch(f){console.error("Error generating flash cards with beta API, attempting fallback:",f);const p=await r.chat.completions.create({model:"gpt-4",messages:[{role:"system",content:o},{role:"user",content:`Please create ${t} flash cards from this content, following the guidelines I provided. Remember that all questions MUST be in Swedish, while answers should be in the original language. Return them in a JSON object with a "flashcards" array property containing the cards.

${e.content}`}],temperature:.5,response_format:{type:"json_object"}});if((d=(u=p.choices[0])==null?void 0:u.message)!=null&&d.content)try{const k=JSON.parse(p.choices[0].message.content);if(Array.isArray(k.flashcards)){const w=G.array(oi).safeParse(k.flashcards);if(w.success)return w.data}throw new Error("Response validation failed")}catch(k){throw console.error("Error parsing fallback response:",k),new Error("Failed to parse response from Azure OpenAI")}throw new Error("Failed to generate flash cards")}}function Pl(r){if(r.length<=1)return r;const e=[];for(const t of r)e.some(s=>{const a=Cs(t.question,s.question),i=Cs(t.answer,s.answer);return a>.92||i>.92})||e.push(t);return e}function Cs(r,e){const t=r.toLowerCase(),n=e.toLowerCase();if(t===n)return 1;if(!t.length||!n.length)return 0;const s=Array(t.length+1).fill(null).map(()=>Array(n.length+1).fill(0));for(let o=0;o<=t.length;o++)s[o][0]=o;for(let o=0;o<=n.length;o++)s[0][o]=o;for(let o=1;o<=t.length;o++)for(let c=1;c<=n.length;c++){const l=t[o-1]===n[c-1]?0:1;s[o][c]=Math.min(s[o-1][c]+1,s[o][c-1]+1,s[o-1][c-1]+l)}const a=s[t.length][n.length],i=Math.max(t.length,n.length);return 1-a/i}console.log("Flash Card Worker loaded");let Rs={status:"idle"};function gt(r,e,t,n){Rs={status:r,progress:e,total:t,error:n},self.postMessage({type:"status",status:Rs})}self.addEventListener("message",async r=>{console.log("Worker received message:",r.data);const{type:e,series:t,config:n,request:s}=r.data;try{if(e==="estimate"){console.log("Starting flash card estimation"),gt("estimating");const a=Math.min(Math.max(t.pages.length*3,5),50);try{if(!n||!n.endpoint||!n.apiKey)throw new Error("Invalid configuration");const i=kl(t,n),o=new Promise((l,u)=>{setTimeout(()=>u(new Error("Estimation timed out after 6 seconds")),6e3)}),c=await Promise.race([i,o]);console.log("Estimated count:",c),self.postMessage({type:"estimate",estimatedCount:c})}catch(i){console.error("Estimation error:",i),console.log("Using fallback count:",a),self.postMessage({type:"estimate",estimatedCount:a})}}else if(e==="generate"&&s){console.log("Starting flash card generation with request:",s),gt("generating",0,1);try{console.log("Calling generateFlashCards with series and config:",{seriesId:t.id,pageCount:t.pages.length,configPresent:!!n,request:s});const a=await Sl(t,n,s,(i,o,c)=>{console.log(`Generation progress: ${i}/${o} - ${c}`),gt("generating",i,o)});console.log(`Generation complete: created ${a.length} flash cards`),gt("complete"),self.postMessage({type:"complete",flashcards:a})}catch(a){console.error("Flash card generation error:",a),gt("error",void 0,void 0,a.message||"Unknown error"),self.postMessage({type:"error",error:a.message||"Failed to generate flash cards"})}}else throw new Error("Unknown message type or missing required data")}catch(a){console.error("Worker error:",a),self.postMessage({type:"error",error:a.message||"An unexpected error occurred in the worker"})}});
